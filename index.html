<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project DNA - The "Aha!" Moment</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/recharts@2.1.9/umd/Recharts.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: #111827; /* bg-gray-900 */ }
        .sticky-chart {
            position: sticky;
            top: 3rem;
            height: calc(100vh - 8rem);
        }
        /* Tailwind's color palette */
        .border-blue-500 { border-color: #3B82F6; }
        .text-blue-300 { color: #93C5FD; }
        .border-orange-500 { border-color: #F97316; }
        .text-orange-300 { color: #FDBA74; }
        .border-red-500 { border-color: #EF4444; }
        .text-red-300 { color: #FCA5A5; }
        .text-yellow-300 { color: #FDE047; }
        .text-cyan-300 { color: #67E8F9; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">

        // Import ที่จำเป็น
        const { useState, useEffect, useRef, forwardRef } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ReferenceLine, Label 
        } = Recharts;

        // --- 1. MOCK DATA (V2) ---
        // (อัปเกรด "ปี" ให้เป็นตัวเลข และเพิ่มจุดข้อมูลตามประวัติศาสตร์!)
        const cumulativeData = [
          // The "Frenzy" [cite: 23]
          { year: 1990, asoke: 4, huaiKhwang: 2, thaphra: 1 },
          { year: 1993, asoke: 35, huaiKhwang: 6, thaphra: 2 }, // Peak [cite: 23]
          { year: 1996, asoke: 55, huaiKhwang: 10, thaphra: 3 }, // Just before crash
          // The "Great Filter" (วิกฤตต้มยำกุ้ง) 
          { year: 1997, asoke: 56, huaiKhwang: 11, thaphra: 3 }, // The CRASH
          // The "Lost Decade" 
          { year: 2000, asoke: 58, huaiKhwang: 13, thaphra: 4 },
          { year: 2004, asoke: 70, huaiKhwang: 20, thaphra: 5 }, // Rebirth starts [cite: 26]
          { year: 2010, asoke: 128, huaiKhwang: 60, thaphra: 8 },
          // The "Big Bang" 
          { year: 2015, asoke: 165, huaiKhwang: 98, thaphra: 12 }, // Just before boom
          { year: 2016, asoke: 170, huaiKhwang: 102, thaphra: 14 }, // The BOOM 
          { year: 2020, asoke: 200, huaiKhwang: 125, thaphra: 15 },
          { year: 2024, asoke: 210, huaiKhwang: 128, thaphra: 18 },
        ];
        
        // (Insight Data จากไฟล์ Word)
        const insights = [
          {
            id: 'asoke',
            title: 'อโศก: "พยานแห่งประวัติศาสตร์"',
            subtitle: 'The Historical Witness [cite: 21]',
            description: 'กราฟอโศก (สีน้ำเงิน) คือตัวแทนของประวัติศาสตร์ [cite: 21] พุ่งขึ้นสุดขีดในปี 1993 [cite: 23] และ "ถูกล้างบาง" ด้วยวิกฤตต้มยำกุ้งปี 1997  กราฟนิ่งไปเกือบ 10 ปีก่อนจะฟื้นตัว [cite: 25, 26]',
            insight: 'Actionable Insight: อโศกคือ "ตลาดวัยกลางคน" (Mature Market) [cite: 79] ความเสี่ยงคือ "ความล้าสมัย" (Aging) [cite: 82, 86]',
            color: 'blue',
          },
          {
            id: 'huaiKhwang',
            title: 'ห้วยขวาง: "พรมแดนประชากรใหม่"',
            subtitle: 'The New Demographic Frontier [cite: 32]',
            description: 'ดูกราฟห้วยขวาง (สีส้ม) จะเห็นว่ามัน "เรียบสนิท" (Dead Flat Line) [cite: 34] มาตลอด จนกระทั่ง "ระเบิด" (Big Bang) [cite: 35] ขึ้นหลังปี 2016 สาเหตุคือ "The China Wave" [cite: 36] และ "Thai First Jobbers" [cite: 37]',
            insight: 'Actionable Insight: ห้วยขวางคือ "ตลาดวัยรุ่น" (Adolescent Market) [cite: 87] ความเสี่ยงคือ "การแข่งขันกันเอง" (Intense Competition) [cite: 91]',
            color: 'orange',
          },
          {
            id: 'thaphra',
            title: 'ท่าพระ: "ชุมทางแห่งอนาคต"',
            subtitle: 'The Infrastructure Hub [cite: 40]',
            description: 'ท่าพระ (สีแดง) ก็ "เรียบสนิท" เหมือนกัน [cite: 42] จุดเปลี่ยนคือปี 2016-2021 เมื่อ "MRT สายสีน้ำเงินส่วนต่อขยาย" [cite: 43] ทำให้ที่นี่กลายเป็น Interchange Developer จึงเข้ามาก่อน Demand [cite: 44]',
            insight: 'Actionable Insight: ตลาดนี้ "เกิดจากรางรถไฟ ไม่ใช่เกิดจากคน" [cite: 46] ความเสี่ยงคือ "Demand ที่คาดไว้อาจไม่มาจริง" [cite: 99]',
            color: 'red',
          },
        ];

        // --- 2. COMPONENT: InsightCard ---
        const InsightCard = forwardRef(({ title, subtitle, description, insight, color }, ref) => (
            <div ref={ref} className={`p-6 mb-8 border-l-4 border-${color}-500 bg-gray-800 rounded-lg shadow-lg opacity-95`}>
              <h2 className={`text-2xl font-bold text-${color}-300`}>{title}</h2>
              <h3 className="text-lg font-semibold text-gray-300 mb-2">{subtitle}</h3>
              <p className="text-gray-400 mb-3">{description}</p>
              <p className="text-yellow-300 font-medium italic">{insight}</p>
            </div>
        ));

        // --- 3. COMPONENT: CumulativeChart (V2: The "Aha!" Moment) ---
        const CumulativeChart = ({ activeDistrict }) => {
            const colors = {
                asoke: '#3B82F6', // blue-500
                huaiKhwang: '#F97316', // orange-500
                thaphra: '#EF4444', // red-500
            };
            
            const getProps = (id) => ({
                strokeWidth: activeDistrict === id ? 5 : 2,
                opacity: (activeDistrict && activeDistrict !== id) ? 0.3 : 1,
            });

            return (
                <div className="w-full h-96 md:h-full bg-gray-800 rounded-lg p-6 pt-10 shadow-inner">
                    <ResponsiveContainer width="100%" height="100%">
                        <LineChart
                            data={cumulativeData}
                            margin={{ top: 5, right: 30, left: 0, bottom: 5 }}
                        >
                            <CartesianGrid strokeDasharray="3 3" stroke="#4B5563" />
                            <XAxis 
                                dataKey="year" 
                                type="number"
                                domain={['dataMin', 'dataMax']}
                                stroke="#9CA3AF" 
                                tickFormatter={(tick) => Math.floor(tick)} // แสดงเป็นเลขปีเต็ม
                            />
                            <YAxis stroke="#9CA3AF" />
                            <Tooltip 
                                contentStyle={{ backgroundColor: '#1F2937', border: '1px solid #374151', borderRadius: '8px' }}
                                labelStyle={{ color: '#F3F4F6' }}
                            />
                            <Legend />

                            {/* !!! -------------------------------- !!!
                              !!!      นี่คือ "อาวุธ" 10% ของเรา      !!!
                              !!! -------------------------------- !!!
                            */}
                            <ReferenceLine x={1997} stroke="red" strokeDasharray="4 4">
                              <Label 
                                value="วิกฤตต้มยำกุ้ง (The Great Filter)" 
                                position="top"
                                fill="red" 
                                fontSize={14} 
                                fontWeight="bold"
                                angle={-45}
                                dx={-50}
                                dy={-10}
                              />
                            </ReferenceLine>

                            <ReferenceLine x={2016} stroke="#67E8F9" strokeDasharray="4 4">
                              <Label 
                                value="The Big Bang (MRT + China Wave)" 
                                position="top"
                                fill="#67E8F9" 
                                fontSize={14} 
                                fontWeight="bold"
                                angle={-45}
                                dx={-50}
                                dy={-10}
                              />
                            </ReferenceLine>
                            {/* !!! -------------------------------- !!!
                              !!!      จบส่วน "อาวุธ" 10%           !!!
                              !!! -------------------------------- !!!
                            */}

                            <Line
                                type="monotone" dataKey="asoke" name="Asoke"
                                stroke={colors.asoke} dot={true} {...getProps('asoke')}
                                className="transition-all duration-300"
                            />
                            <Line
                                type="monotone" dataKey="huaiKhwang" name="Huai Khwang"
                                stroke={colors.huaiKhwang} dot={true} {...getProps('huaiKhwang')}
                                className="transition-all duration-300"
                            />
                            <Line
                                type="monotone" dataKey="thaphra" name="Thaphra"
                                stroke={colors.thaphra} dot={true} {...getProps('thaphra')}
                                className="transition-all duration-300"
                            />
                        </LineChart>
                    </ResponsiveContainer>
                </div>
            );
        };

        // --- 4. COMPONENT: DistrictAnalyzer (หน้าหลัก) ---
        const DistrictAnalyzer = () => {
            const [activeDistrict, setActiveDistrict] = useState(null);
            const insightRefs = {
                asoke: useRef(null),
                huaiKhwang: useRef(null),
                thaphra: useRef(null),
            };

            useEffect(() => {
                const observerOptions = {
                    root: null, 
                    rootMargin: '-40% 0px -40% 0px', // Highlight ตอนการ์ดอยู่กลางจอ
                    threshold: 0
                };

                const observerCallback = (entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const id = Object.keys(insightRefs).find(
                                key => insightRefs[key].current === entry.target
                            );
                            setActiveDistrict(id);
                        }
                    });
                };

                const observer = new IntersectionObserver(observerCallback, observerOptions);
                Object.values(insightRefs).forEach(ref => {
                    if (ref.current) observer.observe(ref.current);
                });
                return () => {
                    Object.values(insightRefs).forEach(ref => {
                        if (ref.current) observer.unobserve(ref.current);
                    });
                };
            }, []);

            return (
                <div className="min-h-screen text-white p-8 md:p-12">
                    <header className="text-center mb-12">
                        <h1 className="text-4xl md:text-5xl font-extrabold mb-2">
                            The "Aha!" Moment
                        </h1>
                        <p className="text-xl text-gray-400">
                            "เราไม่ได้โชว์ Data... เราโชว์ 'DNA' ของตลาด"
                        </p>
                    </header>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-12">
                        
                        {/* คอลัมน์ซ้าย: กราฟ (Sticky) */}
                        <aside className="sticky-chart">
                            <CumulativeChart activeDistrict={activeDistrict} />
                        </aside>

                        {/* คอลัมน์ขวา: Insights (Scrollytelling) */}
                        <main>
                            {insights.map((insight) => (
                                <InsightCard
                                    key={insight.id}
                                    ref={insightRefs[insight.id]}
                                    {...insight}
                                />
                            ))}
                            <div style={{ height: '50vh' }}></div>
                        </main>
                    </div>
                </div>
            );
        };

        // --- 5. START THE APP ---
        ReactDOM.render(<DistrictAnalyzer />, document.getElementById('root'));

    </script>
</body>
</html>
